<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D·ª± B√°o Th·ªùi Ti·∫øt - Trang Ch·ªß</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Poppins", sans-serif;
            background: linear-gradient(135deg, #6b7280, #1e3a8a);
            min-height: 100vh;
            margin: 0;
            color: white;
        }
        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .nav-menu {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        .nav-menu a,
        .nav-menu span {
            color: white;
            font-weight: 600;
            transition: color 0.3s ease;
            cursor: pointer;
        }
        .nav-menu a:hover,
        .nav-menu span:hover {
            color: #93c5fd;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 20;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        .modal-content input {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 5px;
            padding: 0.75rem;
            color: white;
            width: 100%;
            margin-bottom: 1rem;
        }
        .modal-content button {
            background: #3b82f6;
            border: none;
            border-radius: 5px;
            padding: 0.75rem;
            color: white;
            width: 100%;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .modal-content button:hover {
            background: #2563eb;
        }
        #hourly-weather {
            display: flex;
            overflow-x: auto;
            gap: 1rem;
            padding: 1rem;
            max-width: 100%;
            scrollbar-width: thin;
            scrollbar-color: #93c5fd transparent;
        }
        #hourly-weather::-webkit-scrollbar {
            height: 8px;
        }
        #hourly-weather::-webkit-scrollbar-track {
            background: transparent;
        }
        #hourly-weather::-webkit-scrollbar-thumb {
            background-color: #93c5fd;
            border-radius: 4px;
        }
        .scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            padding: 0.5rem;
            cursor: pointer;
            z-index: 10;
        }
        .scroll-left { left: 1rem; }
        .scroll-right { right: 1rem; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">D·ª∞ B√ÅO TH·ªúI TI·∫æT</h1>
            <div class="nav-menu">
                <a href="weathercity.html">Th·ªùi Ti·∫øt Hi·ªán T·∫°i</a>
                <a href="CO2.html">T·∫°i khu v·ª±c</a>
                <a href="Map.html">B·∫£n ƒê·ªì Th·ªùi Ti·∫øt</a>
                <a href="#history">L·ªãch S·ª≠ T√¨m Ki·∫øm</a>
                <a id="loginLink" onclick="openModal('loginModal')">ƒêƒÉng Nh·∫≠p</a>
                <a id="registerLink" onclick="openModal('registerModal')">ƒêƒÉng K√Ω</a>
                <span id="userInfo" class="hidden"></span>
                <a id="logoutLink" class="hidden" onclick="logout()">ƒêƒÉng Xu·∫•t</a>
            </div>
        </div>
    </nav>

    <!-- PH·∫¶N HI·ªÇN TH·ªä CH·∫§T L∆Ø·ª¢NG KH√îNG KH√ç -->
    <section class="px-6 py-8 text-left">
        <h2 class="text-3xl font-semibold mb-4 text-white">üìç Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠ theo khu v·ª±c</h2>
        <div class="flex flex-col sm:flex-row sm:items-center sm:gap-4">
            <input id="cityInput" type="text" placeholder="Nh·∫≠p t√™n khu v·ª±c, v√≠ d·ª•: H√† N·ªôi" class="p-4 text-lg rounded text-black w-full sm:w-2/3 mb-4 sm:mb-0">
            <button onclick="searchCity(event)" class="text-lg px-8 py-3 bg-blue-600 text-white rounded hover:bg-blue-700">üîç T√¨m</button>
        </div>
        <div id="air-quality" class="text-left mt-4 text-base text-white">
            ƒêang t·∫£i d·ªØ li·ªáu...
        </div>
    </section>

    <!-- PH·∫¶N D·ª∞ B√ÅO TH·ªúI TI·∫æT THEO GI·ªú -->
    <section class="px-6 py-8 text-center relative">
        <h2 class="text-3xl font-semibold mb-4 text-white">‚è∞ D·ª± b√°o th·ªùi ti·∫øt theo gi·ªù</h2>
        <div id="hourly-weather"></div>
        <button class="scroll-btn scroll-left" onclick="scrollWeather(-1)">&#10094;</button>
        <button class="scroll-btn scroll-right" onclick="scrollWeather(1)">&#10095;</button>
    </section>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-semibold text-center mb-4">ƒêƒÉng Nh·∫≠p</h2>
            <input type="email" id="loginEmail" placeholder="Email" required>
            <input type="password" id="loginPassword" placeholder="M·∫≠t kh·∫©u" required>
            <button onclick="login(event)">ƒêƒÉng Nh·∫≠p</button>
            <p class="text-center mt-4">
                Ch∆∞a c√≥ t√†i kho·∫£n? <span class="underline cursor-pointer" onclick="switchModal('registerModal')">ƒêƒÉng k√Ω</span>
            </p>
        </div>
    </div>
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-semibold text-center mb-4">ƒêƒÉng K√Ω</h2>
            <input type="email" id="registerEmail" placeholder="Email" required>
            <input type="password" id="registerPassword" placeholder="M·∫≠t kh·∫©u" required>
            <button onclick="register(event)">ƒêƒÉng K√Ω</button>
            <p class="text-center mt-4">
                ƒê√£ c√≥ t√†i kho·∫£n? <span class="underline cursor-pointer" onclick="switchModal('loginModal')">ƒêƒÉng nh·∫≠p</span>
            </p>
        </div>
    </div>

    <script>
        const apiKey = "57d97ca9ff9d860bf41660ffe0c23aec"; // Thay b·∫±ng API key c·ªßa b·∫°n cho ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠
        const weatherAPIKey = "xOPtnipmVta8ckcre2pGAbqEOEBLgOVq"; // API key cho d·ª± b√°o th·ªùi ti·∫øt
        let users = JSON.parse(localStorage.getItem("users")) || {};

          // T√¨m ki·∫øm khu v·ª±c
        async function searchCity(event) {
            event.preventDefault();
            const city = document.getElementById("cityInput").value.trim();
            if (!city) return alert("Vui l√≤ng nh·∫≠p t√™n khu v·ª±c.");

            try {
                const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=1&appid=${apiKey}`);
                const geoData = await geoRes.json();
                if (!geoData[0]) {
                    document.getElementById("air-quality").innerHTML = "‚ùå Kh√¥ng t√¨m th·∫•y v·ªã tr√≠.";
                    return;
                }
                const { lat, lon } = geoData[0];
                fetchAirQuality(lat, lon);
            } catch (error) {
                document.getElementById("air-quality").innerHTML = "‚ö†Ô∏è L·ªói khi t√¨m v·ªã tr√≠.";
                console.error("L·ªói t√¨m ki·∫øm v·ªã tr√≠:", error);
            }
        }

        // L·∫•y d·ªØ li·ªáu ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠
        function fetchAirQuality(lat, lon) {
            fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`)
                .then(response => response.json())
                .then(data => {
                    const aqi = data.list[0].main.aqi;
                    const components = data.list[0].components;
                    const levels = ["T·ªët", "Trung b√¨nh", "Kh√¥ng t·ªët", "X·∫•u", "Nguy h·∫°i"];
                    const icons = ["‚úÖ", "üôÇ", "üòê", "üò∑", "‚ò†Ô∏è"];
                    const bgColors = ["#4ade80", "#fde68a", "#fdba74", "#fca5a5", "#c4b5fd"];

                    const bgColor = bgColors[aqi - 1];
                    const levelText = levels[aqi - 1];
                    const icon = icons[aqi - 1];

                    const html = `
                        <div class="text-left" style="background: ${bgColor}; padding: 20px; color: #1f2937; border-radius: 8px;">
                            <p class="text-2xl font-bold mb-3">${icon} Ch·ªâ s·ªë AQI: ${aqi} - ${levelText}</p>
                            <p><strong>CO (Cacbon monoxit):</strong> ${components.co} Œºg/m¬≥</p>
                            <p><strong>NO‚ÇÇ (Nit∆° dioxit):</strong> ${components.no2} Œºg/m¬≥</p>
                            <p><strong>B·ª•i m·ªãn PM2.5:</strong> ${components.pm2_5} Œºg/m¬≥</p>
                            <p><strong>B·ª•i m·ªãn PM10:</strong> ${components.pm10} Œºg/m¬≥</p>
                            <p><strong>O‚ÇÉ (√îz√¥n):</strong> ${components.o3} Œºg/m¬≥</p>
                        </div>
                    `;

                    document.getElementById("air-quality").innerHTML = html;
                })
                .catch(error => {
                    document.getElementById("air-quality").innerHTML = "‚ö†Ô∏è Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠.";
                    console.error("L·ªói API kh√¥ng kh√≠:", error);
                });
        }

        // M·ªü modal
        function openModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.add("active");
        }

        // ƒê√≥ng modal
        function closeModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.remove("active");
        }

        // Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c modal
        function switchModal(targetId) {
            closeModal("loginModal");
            closeModal("registerModal");
            openModal(targetId);
        }

        // ƒêƒÉng k√Ω
        function register(event) {
            event.preventDefault();
            const email = document.getElementById("registerEmail").value.trim();
            const password = document.getElementById("registerPassword").value;
            if (!email || !password) {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");
                return;
            }
            if (users[email]) {
                alert("Email ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω!");
                return;
            }
            users[email] = simpleHash(password);
            localStorage.setItem("users", JSON.stringify(users));
            alert("ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.");
            closeModal("registerModal");
            openModal("loginModal");
        }

        // ƒêƒÉng nh·∫≠p
        function login(event) {
            event.preventDefault();
            const email = document.getElementById("loginEmail").value.trim();
            const password = document.getElementById("loginPassword").value;
            if (!email || !password) {
                alert("Vui l√≤ng ƒëi·ªÅn email v√† m·∫≠t kh·∫©u!");
                return;
            }
            const hashedPassword = simpleHash(password);
            if (users[email] !== hashedPassword) {
                alert("Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!");
                return;
            }
            localStorage.setItem("loggedInUser", email);
            closeModal("loginModal");
            checkLoginStatus();
        }

        // ƒêƒÉng xu·∫•t
        function logout() {
            localStorage.removeItem("loggedInUser");
            checkLoginStatus();
        }

        // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
        function checkLoginStatus() {
            users = JSON.parse(localStorage.getItem("users")) || {};
            const loggedInUser = localStorage.getItem("loggedInUser");
            const loginLink = document.getElementById("loginLink");
            const registerLink = document.getElementById("registerLink");
            const userInfo = document.getElementById("userInfo");
            const logoutLink = document.getElementById("logoutLink");

            if (loggedInUser && users[loggedInUser]) {
                loginLink.classList.add("hidden");
                registerLink.classList.add("hidden");
                userInfo.classList.remove("hidden");
                logoutLink.classList.remove("hidden");
                userInfo.textContent = `Xin ch√†o, ${loggedInUser}`; // Hi·ªÉn th·ªã email
            } else {
                loginLink.classList.remove("hidden");
                registerLink.classList.remove("hidden");
                userInfo.classList.add("hidden");
                logoutLink.classList.add("hidden");
            }
        }

        // H√†m m√£ h√≥a ƒë∆°n gi·∫£n
        function simpleHash(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                hash = (hash << 5) - hash + password.charCodeAt(i);
                hash |= 0;
            }
            return hash.toString();
        }

      

        // L·∫•y v√† hi·ªÉn th·ªã d·ª± b√°o th·ªùi ti·∫øt theo gi·ªù
        const weatherContainer = document.getElementById("hourly-weather");

        function getWeatherIcon(code) {
            if (code >= 1000 && code < 1100) return "‚òÅÔ∏è";
            if (code >= 4000 && code < 5000) return "üåß";
            if (code >= 5000 && code < 6000) return "‚ùÑÔ∏è";
            return "üå°";
        }

        function scrollWeather(direction) {
            weatherContainer.scrollBy({ left: direction * 150, behavior: "smooth" });
        }

        fetch(`https://api.tomorrow.io/v4/timelines?location=21.03,105.85&fields=temperature,precipitationProbability,weatherCode&timesteps=1h&apikey=${weatherAPIKey}`)
            .then(res => res.json())
            .then(data => {
                const intervals = data.data.timelines[0].intervals.slice(0, 24);
                intervals.forEach(item => {
                    const date = new Date(item.startTime);
                    const hour = `${date.getHours()}h`;
                    const temp = Math.round(item.values.temperature);
                    const pop = Math.round(item.values.precipitationProbability);
                    const icon = getWeatherIcon(item.values.weatherCode);

                    const card = document.createElement("div");
                    card.className = "min-w-[100px] bg-white bg-opacity-10 text-center rounded-xl px-4 py-5 backdrop-blur text-white flex-shrink-0 text-lg";
                    card.innerHTML = `
                        <div class="font-bold text-xl mb-1">${hour}</div>
                        <div class="text-3xl mb-1">${icon}</div>
                        <div class="text-lg">${temp}¬∞C</div>
                        <div class="text-sm">${pop}% üåß</div>
                    `;
                    weatherContainer.appendChild(card);
                });
            })
            .catch(err => console.error("L·ªói th·ªùi ti·∫øt theo gi·ªù:", err));

        // Kh·ªüi t·∫°o trang
        window.onload = () => {
            checkLoginStatus();
            fetchAirQuality(21.0285, 105.8542); // M·∫∑c ƒë·ªãnh t·∫£i H√† N·ªôi
        };
    </script>
</body>
</html>